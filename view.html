<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CCTV Hack </title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: #f0f2f5;
    padding: 10px;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  #searchBox {
    display: block;
    width: 100%;
    max-width: 400px;
    margin: 10px auto 20px;
    padding: 10px;
    font-size: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
  }
  .grid-item {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    cursor: pointer;
    overflow: hidden;
    transition: transform 0.2s;
  }
  .grid-item:hover {
    transform: translateY(-5px);
  }
  .grid-item img {
    width: 100%;
    display: block;
    height: 120px;
    object-fit: cover;
  }
  .grid-item-title {
    padding: 8px;
    text-align: center;
    font-weight: bold;
    color: #555;
  }
  /* Custom Alert Box */
  .custom-alert {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.25);
    z-index: 1000;
    text-align: center;
    padding: 20px;
  }
  .custom-alert h2 {
    margin-top: 0;
    font-size: 18px;
    color: #333;
  }
  .custom-alert img {
    width: 100%;
    border-radius: 8px;
    margin-top: 10px;
  }
  .overlay {
    display: none;
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.4);
    z-index: 900;
  }
  .close-btn {
    margin-top: 10px;
    background: #ff3b30;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>CCTV Grid Viewer</h1>
<input type="text" id="searchBox" placeholder="Search by title...">

<div class="grid" id="gridContainer"></div>

<div class="overlay" id="overlay"></div>
<div class="custom-alert" id="alertBox">
  <h2 id="alertTitle"></h2>
  <img id="alertImage" src="" alt="CCTV Image">
  <button class="close-btn" id="closeBtn">Close</button>
</div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const lang = urlParams.get('lang') || 'JP'; // URL မှာ ?lang=JP လို့ပေးရင် အဲ့လို
  const jsonUrl = `https://raw.githubusercontent.com/ZinDown/CCTV/refs/heads/main/${lang}.json`;

  const gridContainer = document.getElementById('gridContainer');
  const searchBox = document.getElementById('searchBox');
  const alertBox = document.getElementById('alertBox');
  const alertTitle = document.getElementById('alertTitle');
  const alertImage = document.getElementById('alertImage');
  const overlay = document.getElementById('overlay');
  const closeBtn = document.getElementById('closeBtn');

  let cctvData = [];

  async function fetchData() {
    try {
      const res = await fetch(jsonUrl);
      const data = await res.json();
      cctvData = data.cctv;
      renderGrid(cctvData);
    } catch (e) {
      console.error("Error fetching JSON:", e);
      gridContainer.innerHTML = "<p style='color:red; text-align:center;'>Failed to load data</p>";
    }
  }

  function renderGrid(items) {
    gridContainer.innerHTML = '';
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'grid-item';
      div.innerHTML = `
        <img src="${item.src}" alt="${item.title}">
        <div class="grid-item-title">${item.title}</div>
      `;
      div.addEventListener('click', () => openAlert(item));
      gridContainer.appendChild(div);
    });
  }

  function openAlert(item) {
    alertTitle.textContent = item.title;
    let count = 0;
    const interval = setInterval(() => {
      alertImage.src = item.src + '?t=' + new Date().getTime(); // cache bypass
      count++;
      if(count >= 3) clearInterval(interval);
    }, 1000/3); // 1 second မှာ 3 ချက် load

    alertBox.style.display = 'block';
    overlay.style.display = 'block';
  }

  function closeAlert() {
    alertBox.style.display = 'none';
    overlay.style.display = 'none';
  }

  closeBtn.addEventListener('click', closeAlert);
  overlay.addEventListener('click', closeAlert);

  searchBox.addEventListener('input', () => {
    const filtered = cctvData.filter(item => item.title.toLowerCase().includes(searchBox.value.toLowerCase()));
    renderGrid(filtered);
  });

  fetchData();
</script>

</body>
</html>
